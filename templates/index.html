<!DOCTYPE html>
<html>
<head>
    <title>Powerball AI Generator - Complete</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; color: #333; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; color: white; margin-bottom: 30px; }
        .header h1 { font-size: 3rem; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .header p { font-size: 1.2rem; opacity: 0.9; }
        .controls { background: white; border-radius: 15px; padding: 30px; margin-bottom: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .control-row { display: flex; gap: 20px; align-items: center; justify-content: center; flex-wrap: wrap; margin-bottom: 20px; }
        .btn { background: linear-gradient(45deg, #e74c3c, #c0392b); color: white; padding: 15px 30px; border: none; border-radius: 25px; font-size: 16px; font-weight: bold; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3); }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4); }
        .btn:active { transform: translateY(0); }
        .btn-secondary { background: linear-gradient(45deg, #3498db, #2980b9); box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3); }
        .btn-secondary:hover { box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4); }
        .settings { display: flex; gap: 20px; align-items: center; flex-wrap: wrap; }
        .setting-group { display: flex; flex-direction: column; gap: 5px; }
        .setting-group label { font-weight: bold; color: #555; }
        .setting-group select, .setting-group input { padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px; }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .tab { padding: 10px 20px; background: #ecf0f1; border: none; border-radius: 8px 8px 0 0; cursor: pointer; font-weight: bold; transition: all 0.3s ease; }
        .tab.active { background: white; color: #e74c3c; }
        .tab-content { background: white; border-radius: 0 15px 15px 15px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); min-height: 400px; }
        .results-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .result-card { background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-radius: 15px; padding: 25px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); transition: transform 0.3s ease; }
        .result-card:hover { transform: translateY(-5px); }
        .model-name { font-size: 18px; font-weight: bold; color: #2c3e50; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px; }
        .numbers-display { text-align: center; margin: 20px 0; }
        .white-balls { display: flex; justify-content: center; gap: 10px; margin-bottom: 15px; }
        .number-ball { width: 50px; height: 50px; background: linear-gradient(135deg, #34495e, #2c3e50); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 18px; box-shadow: 0 3px 10px rgba(0,0,0,0.2); }
        .powerball { width: 60px; height: 60px; background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 20px; margin: 0 auto; box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3); }
        .analysis { background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 15px; }
        .analysis h4 { color: #2c3e50; margin-bottom: 10px; }
        .stat-item { display: flex; justify-content: space-between; margin-bottom: 8px; padding: 5px 0; border-bottom: 1px solid #dee2e6; }
        .loading { text-align: center; padding: 50px; display: none; }
        .spinner { width: 50px; height: 50px; border: 5px solid #f3f3f3; border-top: 5px solid #e74c3c; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .frequency-details { background: #e8f5e8; padding: 10px; border-radius: 8px; margin-top: 10px; font-size: 12px; }
        .pattern-details { background: #fff3cd; padding: 10px; border-radius: 8px; margin-top: 10px; font-size: 12px; }
        .error-message { color: #e74c3c; background: #ffe6e6; padding: 15px; border-radius: 8px; margin: 20px 0; text-align: center; }
        @media (max-width: 768px) {
            .header h1 { font-size: 2rem; }
            .controls { padding: 20px; }
            .control-row { flex-direction: column; align-items: stretch; }
            .btn { width: 100%; margin-bottom: 10px; }
            .results-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé± Powerball AI Generator</h1>
            <p>Complete with 2025 Frequency Analysis, Pattern Detection & Group A Combinations</p>
        </div>
        
        <div class="controls">
            <div class="control-row">
                <button class="btn" onclick="generateNumbers()">üé≤ Generate Numbers</button>
                <button class="btn btn-secondary" onclick="showAnalytics()">üìä View Analytics</button>
                <button class="btn btn-secondary" onclick="showHistory()">üìà History</button>
                <button class="btn btn-secondary" onclick="testAPI()">üîß Test API</button>
            </div>
            <div class="settings">
                <div class="setting-group">
                    <label>Model:</label>
                    <select id="modelPriority">
                        <option value="all">All Models</option>
                        <option value="ensemble">Ensemble</option>
                        <option value="random_forest">Random Forest</option>
                        <option value="gradient_boosting">Gradient Boosting</option>
                        <option value="knn">KNN</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label>Analysis:</label>
                    <select id="analysisDepth">
                        <option value="basic">Basic</option>
                        <option value="detailed">Detailed</option>
                        <option value="advanced">Advanced (with Patterns)</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label>Show Debug:</label>
                    <input type="checkbox" id="showDebug">
                </div>
            </div>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('predictions')">üéØ Predictions</button>
            <button class="tab" onclick="showTab('analytics')">üìä Analytics</button>
            <button class="tab" onclick="showTab('groupA')">üé± Group A</button>
            <button class="tab" onclick="showTab('history')">üìù History</button>
            <button class="tab" onclick="showTab('insights')">üí° Insights</button>
        </div>
        
        <div class="tab-content">
            <div id="predictions-tab">
                <div class="loading" id="loading"><div class="spinner"></div><p>Generating your lucky numbers...</p></div>
                <div id="error-container"></div>
                <div id="debug-container"></div>
                <div id="results-container" class="results-grid"></div>
            </div>
            
            <div id="analytics-tab" style="display:none;">
                <h3>üìà 2025 Frequency Analytics</h3>
                <button class="btn btn-secondary" onclick="loadFrequencyAnalysis()">üìä Load Stats</button>
                <button class="btn btn-secondary" onclick="debugData()">üîß Debug Data</button>
                <div class="settings" style="margin-top:20px;">
                    <div class="setting-group">
                        <label>Sort:</label>
                        <select id="frequencySort" onchange="updateFrequencyDisplay()">
                            <option value="frequency_desc">Frequency ‚Üì</option>
                            <option value="frequency_asc">Frequency ‚Üë</option>
                            <option value="number_asc">Number ‚Üí</option>
                        </select>
                    </div>
                    <div class="setting-group">
                        <label>Filter:</label>
                        <select id="frequencyFilter" onchange="updateFrequencyDisplay()">
                            <option value="all">All</option>
                            <option value="group_a">Group A</option>
                            <option value="non_group_a">Non-Group A</option>
                        </select>
                    </div>
                </div>
                <div id="frequency-stats"></div>
            </div>
            
            <div id="groupA-tab" style="display:none;">
                <h3>üé± Group A Analysis</h3>
                <button class="btn btn-secondary" onclick="loadGroupAAnalysis()">üìä Summary</button>
                <button class="btn btn-secondary" onclick="loadDetailedGroupAAnalysis()">üîç Combinations</button>
                <div class="settings" style="margin-top:20px;">
                    <div class="setting-group">
                        <label>View:</label>
                        <select id="groupAView" onchange="updateDisplay()">
                            <option value="combinations">Top Combinations</option>
                            <option value="by_year">By Year</option>
                            <option value="overall">Overall</option>
                        </select>
                    </div>
                    <div class="setting-group">
                        <label>Show:</label>
                        <select id="groupALevel" onchange="updateDisplay()">
                            <option value="all">All Levels</option>
                            <option value="5">5 Group A</option>
                            <option value="4">4 Group A</option>
                            <option value="3">3 Group A</option>
                            <option value="2">2 Group A</option>
                        </select>
                    </div>
                    <div class="setting-group">
                        <label>Sort:</label>
                        <select id="groupASort" onchange="updateDisplay()">
                            <option value="frequency">Frequency</option>
                            <option value="recent">Recent</option>
                            <option value="year_spread">Year Spread</option>
                        </select>
                    </div>
                </div>
                <div id="groupA-stats"></div>
            </div>
            
            <div id="history-tab" style="display:none;">
                <h3>üïí Prediction History</h3>
                <div id="history-container"><p>No predictions yet. Generate some numbers to see history!</p></div>
            </div>
            
            <div id="insights-tab" style="display:none;">
                <h3>üí° AI Insights & Recommendations</h3>
                <div id="insights-content">
                    <p>üß† Enhanced frequency and pattern analysis provides:</p>
                    <div class="stat-item"><span>Individual Frequency Calculation:</span><span>2025 Data ‚úÖ</span></div>
                    <div class="stat-item"><span>Pattern Detection:</span><span>Consecutive, Grouped, Repeating ‚úÖ</span></div>
                    <div class="stat-item"><span>Historical Pattern Analysis:</span><span>Cross-year comparison ‚úÖ</span></div>
                    <div class="stat-item"><span>Group A Combinations:</span><span>Detailed tracking ‚úÖ</span></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let predictionHistory=[], currentFrequencyData=null, currentGroupAData=null, detailedGroupAData=null;
        
        async function testAPI() {
            try {
                const res = await fetch('/health');
                const data = await res.json();
                alert(`API Status: ${data.status}\nMessage: ${data.message}`);
            } catch(e) {
                alert('API test failed: ' + e.message);
            }
        }
        
        async function generateNumbers() {
            const container = document.getElementById('results-container');
            const loading = document.getElementById('loading');
            const errorDiv = document.getElementById('error-container');
            const debugDiv = document.getElementById('debug-container');
            container.innerHTML = ''; errorDiv.innerHTML = ''; debugDiv.innerHTML = ''; loading.style.display = 'block';
            
            try {
                const res = await fetch('/generate');
                const data = await res.json();
                loading.style.display = 'none';
                
                const priority = document.getElementById('modelPriority').value;
                const depth = document.getElementById('analysisDepth').value;
                const showDebug = document.getElementById('showDebug').checked;
                
                if(showDebug) {
                    debugDiv.innerHTML = `<div style="background:#f0f0f0;padding:10px;border-radius:5px;margin:10px 0;font-family:monospace;font-size:12px;">
                        <strong>Debug:</strong> Models: ${Object.keys(data).join(', ')}<br>
                        Raw: ${JSON.stringify(data, null, 2).substring(0, 200)}...
                    </div>`;
                }
                
                const filtered = priority === 'all' ? data : (data[priority] ? {[priority]: data[priority]} : data);
                
                for (const model in filtered) {
                    const card = createCard(model, filtered[model], depth);
                    container.appendChild(card);
                    predictionHistory.unshift({
                        date: new Date().toLocaleDateString(), 
                        model, 
                        numbers: filtered[model].generated_numbers,
                        analysis: filtered[model].analysis
                    });
                }
                
                predictionHistory = predictionHistory.slice(0, 50);
            } catch(e) {
                loading.style.display = 'none';
                errorDiv.innerHTML = `<div class="error-message"><strong>Error:</strong> ${e.message}<br><button class="btn btn-secondary" onclick="testAPI()" style="margin-top:10px;">Test API</button></div>`;
            }
        }
        
        function createCard(name, data, depth) {
            const card = document.createElement('div');
            card.className = 'result-card';
            const nums = data?.generated_numbers?.white_balls || [];
            const pb = data?.generated_numbers?.powerball || '?';
            const analysis = data?.analysis || {};
            const freq2025 = analysis['2025_frequency'] || {};
            const freqBreak = analysis.frequency_breakdown || {};
            
            let freqTotal = 0;
            try {
                const wbCounts = freq2025.white_ball_counts || freq2025.individual_frequencies || {};
                const wbTotal = Object.values(wbCounts).reduce((a,b)=>(a||0)+(b||0), 0);
                freqTotal = wbTotal + (freq2025.powerball_count || freqBreak.powerball_frequency || 0);
            } catch(e) {}
            
            let detailsHTML = '';
            if(depth !== 'basic') {
                // Frequency details
                if(freqBreak.individual_white_balls) {
                    const details = [];
                    for(const [num, freq] of Object.entries(freqBreak.individual_white_balls)) {
                        const pct = freqBreak.individual_percentages?.[num] || 0;
                        details.push(`#${num}: ${freq} (${pct}%)`);
                    }
                    detailsHTML += `<div class="frequency-details">
                        <strong>2025 Individual Frequencies:</strong><br>
                        ${details.join(' | ')}<br>
                        <strong>Powerball:</strong> ${freqBreak.powerball_frequency||0} (${freqBreak.powerball_percentage||0}%)
                    </div>`;
                }
                
                // Pattern details (from v1)
                if(depth === 'advanced' && analysis.message) {
                    const msg = analysis.message.replace(/\n/g, '<br>');
                    detailsHTML += `<div class="pattern-details">
                        <strong>üîç Pattern Analysis:</strong><br>
                        ${msg}
                    </div>`;
                }
            }
            
            card.innerHTML = `
                <div class="model-name">${name.replace('_',' ').toUpperCase()}</div>
                <div class="numbers-display">
                    <div class="white-balls">${nums.map(n=>`<div class="number-ball">${n}</div>`).join('')}</div>
                    <div class="powerball">${pb}</div>
                </div>
                <div class="analysis">
                    <h4>üìä Analysis</h4>
                    <div class="stat-item"><span>Group A Numbers:</span><span>${analysis.group_a_count||0}/5</span></div>
                    <div class="stat-item"><span>Odd/Even Ratio:</span><span>${analysis.odd_even_ratio||'N/A'}</span></div>
                    <div class="stat-item"><span>2025 Frequency Total:</span><span>${freqTotal}</span></div>
                    <div class="stat-item"><span>2025 Total Draws:</span><span>${freq2025.total_draws||freq2025.total_2025_draws||0}</span></div>
                    ${detailsHTML}
                </div>
            `;
            return card;
        }
        
        async function debugData() {
            const stats = document.getElementById('frequency-stats');
            stats.innerHTML = '<p>Running diagnostics...</p>';
            try {
                const res = await fetch('/debug_2025_data');
                const data = await res.json();
                stats.innerHTML = `<div style="background:#f0f0f0;padding:20px;border-radius:10px;margin-top:20px;">
                    <h4>üîç Debug Information</h4>
                    <div style="font-family:monospace;font-size:12px;white-space:pre-wrap;max-height:600px;overflow-y:auto;">
                        ${JSON.stringify(data, null, 2)}
                    </div>
                    <button class="btn btn-secondary" onclick="loadFrequencyAnalysis()" style="margin-top:15px;">Try Again</button>
                </div>`;
            } catch(e) {
                stats.innerHTML = `<div class="error-message">Debug failed: ${e.message}</div>`;
            }
        }
        
        async function loadFrequencyAnalysis() {
            const stats = document.getElementById('frequency-stats');
            stats.innerHTML = '<p>Loading 2025 frequency statistics...</p>';
            try {
                const res = await fetch('/current_year_stats');
                currentFrequencyData = await res.json();
                if(currentFrequencyData.error) {
                    stats.innerHTML = `<div class="error-message"><strong>Error:</strong> ${currentFrequencyData.error}</div>`;
                    return;
                }
                updateFrequencyDisplay();
            } catch(e) {
                stats.innerHTML = `<div class="error-message">Error: ${e.message}<br><button class="btn btn-secondary" onclick="loadFrequencyAnalysis()">Retry</button></div>`;
            }
        }
        
        function updateFrequencyDisplay() {
            if(!currentFrequencyData) return;
            const data = currentFrequencyData;
            const sort = document.getElementById('frequencySort')?.value || 'frequency_desc';
            const filter = document.getElementById('frequencyFilter')?.value || 'all';
            
            let nums = Object.entries(data.number_details || {}).map(([n,d])=>({number:parseInt(n), ...d}));
            if(filter==='group_a') nums = nums.filter(n=>n.is_group_a);
            else if(filter==='non_group_a') nums = nums.filter(n=>!n.is_group_a);
            
            if(sort==='frequency_desc') nums.sort((a,b)=>b.frequency-a.frequency);
            else if(sort==='frequency_asc') nums.sort((a,b)=>a.frequency-b.frequency);
            else nums.sort((a,b)=>a.number-b.number);
            
            const groups = {};
            nums.forEach(n=>{ if(!groups[n.frequency]) groups[n.frequency]=[]; groups[n.frequency].push(n); });
            
            let html = `<div style="background:#f8f9fa;padding:20px;border-radius:10px;margin-top:20px;">
                <h4>üìä 2025 Statistics</h4>
                <div class="stat-item"><span><strong>Total Draws:</strong></span><span>${data.total_draws||0}</span></div>
                <div class="stat-item"><span><strong>Last Updated:</strong></span><span>${data.last_updated||'N/A'}</span></div>
                <div class="stat-item"><span><strong>Showing:</strong></span><span>${nums.length} numbers</span></div>
            </div><div style="margin-top:30px;"><h4>üéØ White Ball Frequencies (Grouped)</h4>`;
            
            Object.keys(groups).sort((a,b)=>b-a).forEach(freq=>{
                const items = groups[freq];
                html += `<div style="background:#f8f9fa;padding:15px;border-radius:8px;margin-bottom:15px;">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
                        <strong style="color:#2c3e50;">Appeared ${freq} times (${items[0].percentage}%)</strong>
                        <span style="background:#3498db;color:white;padding:5px 10px;border-radius:5px;font-size:12px;">${items.length} numbers</span>
                    </div>
                    <div style="display:flex;flex-wrap:wrap;gap:8px;">
                        ${items.map(n=>`<span style="display:inline-flex;align-items:center;justify-content:center;min-width:45px;padding:8px 12px;background:${n.is_group_a?'linear-gradient(135deg,#e74c3c,#c0392b)':'linear-gradient(135deg,#34495e,#2c3e50)'};color:white;border-radius:8px;font-weight:bold;font-size:14px;box-shadow:0 2px 5px rgba(0,0,0,0.2);">${n.number}${n.is_group_a?' ‚≠ê':''}</span>`).join('')}
                    </div>
                </div>`;
            });
            
            html += `</div><div style="margin-top:30px;"><h4>‚ö° Powerball Frequencies</h4>
                <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:10px;margin-top:15px;">`;
            
            if(data.powerball_details && typeof data.powerball_details === 'object') {
                Object.entries(data.powerball_details).sort((a,b)=>b[1].frequency-a[1].frequency).forEach(([pb,details])=>{
                    if(details.frequency > 0) {
                        html += `<div class="stat-item" style="background:#ffe6e6;padding:10px;border-radius:5px;">
                            <span><strong>PB #${pb}:</strong></span>
                            <span>${details.frequency} (${details.percentage}%)</span>
                        </div>`;
                    }
                });
            }
            
            html += `</div></div><div style="margin-top:20px;padding:15px;background:#e8f5e8;border-radius:8px;">
                <strong>Legend:</strong> <span style="color:#e74c3c;">‚≠ê Red = Group A</span> | <span style="color:#34495e;">Grey = Non-Group A</span>
            </div>`;
            
            document.getElementById('frequency-stats').innerHTML = html;
        }
        
        async function loadDetailedGroupAAnalysis() {
            const stats = document.getElementById('groupA-stats');
            stats.innerHTML = '<p>Loading detailed combinations...</p>';
            try {
                const res = await fetch('/group_a_detailed_analysis?start_year=2017');
                detailedGroupAData = await res.json();
                updateDisplay();
            } catch(e) {
                stats.innerHTML = `<div class="error-message">Error: ${e.message}</div>`;
            }
        }
        
        async function loadGroupAAnalysis() {
            const stats = document.getElementById('groupA-stats');
            stats.innerHTML = '<p>Loading summary...</p>';
            try {
                const res = await fetch('/group_a_analysis?start_year=2017');
                currentGroupAData = await res.json();
                updateDisplay();
            } catch(e) {
                stats.innerHTML = `<div class="error-message">Error: ${e.message}</div>`;
            }
        }
        
        function updateDisplay() {
            if(detailedGroupAData) updateDetailedGroupADisplay();
            else if(currentGroupAData) updateGroupADisplay();
        }
        
        function updateDetailedGroupADisplay() {
            const data = detailedGroupAData;
            const view = document.getElementById('groupAView').value;
            const level = document.getElementById('groupALevel').value;
            const sort = document.getElementById('groupASort').value;
            
            let html = `<div style="background:#f8f9fa;padding:20px;border-radius:10px;margin-top:20px;">
                <h4>üìä Group A Numbers</h4>
                <div style="display:flex;flex-wrap:wrap;gap:8px;margin-top:10px;">
                    ${data.group_a_numbers.map(n=>`<span style="padding:8px 12px;background:linear-gradient(135deg,#e74c3c,#c0392b);color:white;border-radius:8px;font-weight:bold;">${n}</span>`).join('')}
                </div>
                <div class="stat-item" style="margin-top:15px;"><span><strong>Period:</strong></span><span>${data.start_year}-${data.end_year}</span></div>
                <div class="stat-item"><span><strong>Total Draws:</strong></span><span>${data.overall_statistics.total_draws}</span></div>
            </div>`;
            
            if(view==='combinations' || view==='overall') {
                const combos = data.overall_statistics.most_common_combinations;
                const levels = level==='all' ? [5,4,3,2] : [parseInt(level)];
                
                html += '<div style="margin-top:30px;">';
                levels.forEach(lv=>{
                    if(!combos[lv]) return;
                    let items = [...combos[lv]];
                    if(sort==='recent') items.sort((a,b)=>new Date(b.recent_occurrences[0].date)-new Date(a.recent_occurrences[0].date));
                    else if(sort==='year_spread') items.sort((a,b)=>b.year_count-a.year_count);
                    
                    html += `<div style="margin-bottom:40px;"><h4 style="color:#2c3e50;border-bottom:3px solid #e74c3c;padding-bottom:10px;">${lv} Group A - Top Combinations</h4>`;
                    items.forEach((c,i)=>{
                        html += `<div style="background:${i%2?'#f8f9fa':'#fff'};padding:20px;border-radius:10px;margin-bottom:15px;box-shadow:0 2px 5px rgba(0,0,0,0.1);">
                            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;">
                                <div style="display:flex;gap:8px;flex-wrap:wrap;">
                                    ${c.group_a_combination.map(n=>`<span style="padding:10px 14px;background:linear-gradient(135deg,#e74c3c,#c0392b);color:white;border-radius:8px;font-weight:bold;font-size:16px;">${n}</span>`).join('')}
                                </div>
                                <div style="text-align:right;">
                                    <div style="font-size:24px;font-weight:bold;color:#e74c3c;">${c.total_frequency}x</div>
                                    <div style="font-size:12px;color:#666;">${c.year_count} year${c.year_count>1?'s':''}</div>
                                </div>
                            </div>
                            <div style="margin-top:10px;"><strong>Years:</strong>
                                <div style="display:flex;flex-wrap:wrap;gap:5px;margin-top:5px;">
                                    ${c.appeared_in_years.map(y=>`<span style="background:#3498db;color:white;padding:4px 8px;border-radius:4px;font-size:12px;">${y}</span>`).join('')}
                                </div>
                            </div>
                            <div style="margin-top:15px;"><strong>Recent Occurrences:</strong>
                                <div style="margin-top:10px;">
                                    ${c.recent_occurrences.slice(0,3).map(o=>`<div style="padding:8px;background:#ecf0f1;border-radius:5px;margin-bottom:5px;font-size:13px;">
                                        <strong>${o.date}</strong> (${o.year}) - Non-Group A: ${o.non_group_a.join(', ')}
                                    </div>`).join('')}
                                </div>
                            </div>
                        </div>`;
                    });
                    html += '</div>';
                });
                html += '</div>';
            } else if(view==='by_year') {
                const years = Object.keys(data.analysis_by_year).map(y=>parseInt(y)).sort((a,b)=>b-a);
                const levels = level==='all' ? [5,4,3,2] : [parseInt(level)];
                
                html += '<div style="margin-top:30px;"><h4>üìÖ Year-by-Year Analysis</h4>';
                years.forEach(y=>{
                    const yd = data.analysis_by_year[y];
                    html += `<div style="background:#fff;padding:20px;border-radius:10px;margin-bottom:20px;box-shadow:0 2px 8px rgba(0,0,0,0.1);">
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;">
                            <h5 style="color:#2c3e50;margin:0;">Year ${y}</h5>
                            <span style="background:#3498db;color:white;padding:5px 15px;border-radius:5px;font-size:14px;">${yd.total_draws} draws</span>
                        </div>`;
                    
                    levels.forEach(lv=>{
                        if(!yd.most_common_combinations[lv]) return;
                        html += `<div style="margin-top:15px;"><h6 style="color:#e74c3c;margin-bottom:10px;">${lv} Group A Numbers</h6>`;
                        yd.most_common_combinations[lv].slice(0,5).forEach(c=>{
                            html += `<div style="background:#f8f9fa;padding:10px;border-radius:5px;margin-bottom:8px;">
                                <div style="display:flex;justify-content:space-between;align-items:center;">
                                    <div style="display:flex;gap:5px;flex-wrap:wrap;">
                                        ${c.group_a_combination.map(n=>`<span style="padding:6px 10px;background:linear-gradient(135deg,#e74c3c,#c0392b);color:white;border-radius:6px;font-weight:bold;font-size:13px;">${n}</span>`).join('')}
                                    </div>
                                    <span style="font-weight:bold;color:#2c3e50;">${c.frequency}x</span>
                                </div>
                            </div>`;
                        });
                        html += '</div>';
                    });
                    html += '</div>';
                });
                html += '</div>';
            }
            
            document.getElementById('groupA-stats').innerHTML = html;
        }
        
        function updateGroupADisplay() {
            const data = currentGroupAData;
            const view = document.getElementById('groupAView').value;
            
            let html = `<div style="background:#f8f9fa;padding:20px;border-radius:10px;margin-top:20px;">
                <h4>üìä Group A Summary</h4>
                <div style="display:flex;flex-wrap:wrap;gap:8px;margin-top:10px;">
                    ${Array.from(data.group_a_numbers).sort((a,b)=>a-b).map(n=>`<span style="padding:8px 12px;background:linear-gradient(135deg,#e74c3c,#c0392b);color:white;border-radius:8px;font-weight:bold;">${n}</span>`).join('')}
                </div>
                <div class="stat-item" style="margin-top:15px;"><span><strong>Period:</strong></span><span>${data.start_year}-${data.end_year}</span></div>
                <div class="stat-item"><span><strong>Total Draws:</strong></span><span>${data.overall_statistics.total_draws}</span></div>
            </div>`;
            
            if(view==='overall') {
                html += `<div style="margin-top:30px;"><h4>üìà Overall Distribution (${data.start_year}-${data.end_year})</h4>`;
                html += generateChart(data.overall_statistics) + '</div>';
            } else {
                const years = Object.keys(data.analysis_by_year).map(y=>parseInt(y)).sort((a,b)=>b-a);
                html += '<div style="margin-top:30px;"><h4>üìÖ Year-by-Year Distribution</h4>';
                years.forEach(y=>{
                    const yd = data.analysis_by_year[y];
                    html += `<div style="background:#fff;padding:20px;border-radius:10px;margin-bottom:20px;box-shadow:0 2px 8px rgba(0,0,0,0.1);">
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;">
                            <h5 style="color:#2c3e50;margin:0;">Year ${y}</h5>
                            <span style="background:#3498db;color:white;padding:5px 15px;border-radius:5px;font-size:14px;">${yd.total_draws} draws</span>
                        </div>
                        ${generateChart(yd)}
                    </div>`;
                });
                html += '</div>';
            }
            
            document.getElementById('groupA-stats').innerHTML = html;
        }
        
        function generateChart(stats) {
            const d = stats.distribution, p = stats.percentages;
            const max = Math.max(...Object.values(d));
            let html = '<div style="margin-top:15px;">';
            
            [5,4,3,2,1,0].forEach(c=>{
                const colors = {5:'#e74c3c',4:'#e67e22',3:'#f39c12',2:'#3498db',1:'#9b59b6',0:'#95a5a6'};
                const w = max>0 ? (d[c]/max)*100 : 0;
                html += `<div style="margin-bottom:15px;">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:5px;">
                        <strong style="min-width:150px;">${c} Group A Numbers:</strong>
                        <span style="font-size:14px;color:#666;">${d[c]} times (${p[c]}%)</span>
                    </div>
                    <div style="background:#ecf0f1;border-radius:5px;height:30px;position:relative;overflow:hidden;">
                        <div style="background:${colors[c]};width:${w}%;height:100%;border-radius:5px;transition:width 0.3s ease;display:flex;align-items:center;padding-left:10px;color:white;font-weight:bold;">
                            ${d[c]>0?d[c]:''}
                        </div>
                    </div>
                </div>`;
            });
            html += '</div>';
            return html;
        }
        
        function showTab(name) {
            ['predictions','analytics','groupA','history','insights'].forEach(t=>{
                const el = document.getElementById(`${t}-tab`);
                if(el) el.style.display = 'none';
            });
            document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
            const tab = document.getElementById(`${name}-tab`);
            if(tab) tab.style.display = 'block';
            if(event && event.target) event.target.classList.add('active');
        }
        
        function showAnalytics() { showTab('analytics'); }
        function showHistory() { showTab('history'); updateHistoryTab(); }
        
        function updateHistoryTab() {
            const container = document.getElementById('history-container');
            if(predictionHistory.length === 0) {
                container.innerHTML = '<p>No predictions yet. Generate some numbers to see history!</p>';
                return;
            }
            container.innerHTML = predictionHistory.map(p=>`
                <div style="padding:10px;border-bottom:1px solid #dee2e6;display:flex;justify-content:space-between;align-items:center;">
                    <span><strong>${p.date}</strong> - ${p.model}: ${p.numbers.white_balls.join(', ')} ‚ö° ${p.numbers.powerball}</span>
                    <span style="background:#e8f5e8;padding:5px 10px;border-radius:5px;font-size:12px;">Group A: ${p.analysis?.group_a_count||0}/5</span>
                </div>
            `).join('');
        }
        
        document.addEventListener('DOMContentLoaded', ()=>{
            console.log('Powerball AI Generator ready!');
            testAPI().catch(e=>console.log('Initial API test:', e));
        });
    </script>
</body>
</html>
