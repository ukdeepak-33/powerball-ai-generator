<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Powerball Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            color: #334155;
        }
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 1.5rem;
            background-color: #ffffff;
            border-radius: 1rem;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
        }
        .card {
            background-color: #f8fafc;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.03);
        }
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #475569;
        }
        .form-input, .form-select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #cbd5e1;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            font-size: 1rem;
            color: #334155;
            transition: border-color 0.2s;
        }
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }
        .btn {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            background-color: #6366f1;
            color: #ffffff;
            border-radius: 0.5rem;
            text-align: center;
            font-weight: 600;
            transition: background-color 0.2s, transform 0.1s;
            cursor: pointer;
            border: none;
        }
        .btn:hover {
            background-color: #4f46e5;
            transform: translateY(-1px);
        }
        .btn:active {
            background-color: #4338ca;
            transform: translateY(0);
        }
        .number-display {
            display: flex;
            justify-content: center;
            gap: 0.75rem;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .ball {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 3.5rem;
            height: 3.5rem;
            border-radius: 50%;
            background-color: #f97316; /* Orange for white balls */
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        }
        .powerball {
            background-color: #dc2626; /* Red for powerball */
        }
        .flash-message {
            background-color: #d1fae5;
            color: #065f46;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1.5rem;
            font-weight: 500;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        th, td {
            border: 1px solid #e2e8f0;
            padding: 0.75rem;
            text-align: left;
        }
        th {
            background-color: #eef2f6;
            font-weight: 600;
            color: #475569;
        }
        tr:nth-child(even) {
            background-color: #f8fafc;
        }
        .accordion-header {
            background-color: #f8fafc;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            color: #334155;
            margin-bottom: 0.5rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.02);
            transition: background-color 0.2s;
        }
        .accordion-header:hover {
            background-color: #eef2f6;
        }
        .accordion-content {
            padding: 0 1.5rem 1.5rem 1.5rem;
            background-color: #ffffff;
            border-radius: 0.75rem;
            overflow: hidden;
            max-height: 0;
            transition: max-height 0.3s ease-out, padding 0.3s ease-out;
            opacity: 0;
            pointer-events: none;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.03);
            margin-bottom: 1rem;
        }
        .accordion-content.active {
            max-height: 2000px; /* Arbitrarily large value, ensure it's enough for content */
            padding: 1.5rem;
            opacity: 1;
            pointer-events: auto;
            transition: max-height 0.5s ease-in, padding 0.5s ease-in, opacity 0.5s ease-in;
        }
        .accordion-icon {
            transition: transform 0.3s ease;
        }
        .accordion-header.active .accordion-icon {
            transform: rotate(90deg);
        }
        /* Custom styles for scrollable tables */
        .scrollable-table-container {
            max-height: 400px; /* Adjust as needed */
            overflow-y: auto;
            border: 1px solid #e2e8f0; /* Optional: adds a border around the scrollable area */
            border-radius: 0.5rem;
            margin-top: 1rem;
        }
        .scrollable-table-container table {
            margin-top: 0; /* Remove top margin from table inside container */
        }
        .scrollable-table-container thead th {
            position: sticky;
            top: 0;
            background-color: #eef2f6;
            z-index: 10;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 p-4 sm:p-6 lg:p-8">
    <div class="container">
        <h1 class="text-4xl font-extrabold text-center text-indigo-700 mb-8">Powerball Simulator</h1>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="flash-message {{ 'bg-green-100 text-green-700' if category == 'info' else 'bg-red-100 text-red-700' }} mb-4 p-3 rounded-lg">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- Last Draw Result -->
        <div class="card mb-8">
            <h2 class="text-2xl font-bold text-indigo-600 mb-4">Last Powerball Draw:</h2>
            {% if last_draw %}
                <p class="text-lg mb-2"><span class="font-semibold">Draw Date:</span> {{ last_draw['Draw Date'] }}</p>
                <div class="number-display">
                    {% for i in range(1, 6) %}
                        <div class="ball">{{ last_draw['Number ' + i|string] }}</div>
                    {% endfor %}
                    <div class="ball powerball">{{ last_draw['Powerball'] }}</div>
                </div>
            {% else %}
                <p class="text-lg text-gray-600">No last draw data available.</p>
            {% endif %}
        </div>

        <!-- Accordion for sections -->
        <div class="space-y-4">
            <!-- Generate Numbers Section -->
            <div class="accordion-item">
                <div class="accordion-header" onclick="toggleAccordion(this)">
                    <span>Generate New Numbers</span>
                    <span class="accordion-icon">></span>
                </div>
                <div class="accordion-content">
                    <form action="/generate" method="post" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="odd_even_choice" class="form-label">Odd/Even Distribution:</label>
                            <select id="odd_even_choice" name="odd_even_choice" class="form-select">
                                <option value="Any">Any</option>
                                <option value="All Even">All Even</option>
                                <option value="All Odd">All Odd</option>
                                <option value="3 Even / 2 Odd">3 Even / 2 Odd</option>
                                <option value="3 Odd / 2 Even">3 Odd / 2 Even</option>
                                <option value="1 Even / 4 Odd">1 Even / 4 Odd</option>
                                <option value="1 Odd / 4 Even">1 Odd / 4 Even</option>
                            </select>
                        </div>
                        <div>
                            <label for="combo_choice" class="form-label">Combo Choice:</label>
                            <select id="combo_choice" name="combo_choice" class="form-select">
                                <option value="No Combo">No Combo</option>
                                <option value="2-combo">2-combo</option>
                                <option value="3-combo">3-combo</option>
                            </select>
                        </div>
                        <div>
                            <label for="white_ball_min" class="form-label">White Ball Min (1-69):</label>
                            <input type="number" id="white_ball_min" name="white_ball_min" value="1" min="1" max="69" class="form-input">
                        </div>
                        <div>
                            <label for="white_ball_max" class="form-label">White Ball Max (1-69):</label>
                            <input type="number" id="white_ball_max" name="white_ball_max" value="69" min="1" max="69" class="form-input">
                        </div>
                        <div>
                            <label for="powerball_min" class="form-label">Powerball Min (1-26):</label>
                            <input type="number" id="powerball_min" name="powerball_min" value="1" min="1" max="26" class="form-input">
                        </div>
                        <div>
                            <label for="powerball_max" class="form-label">Powerball Max (1-26):</label>
                            <input type="number" id="powerball_max" name="powerball_max" value="26" min="1" max="26" class="form-input">
                        </div>
                        <div class="md:col-span-2">
                            <label for="excluded_numbers" class="form-label">Excluded Numbers (comma-separated):</label>
                            <input type="text" id="excluded_numbers" name="excluded_numbers" placeholder="e.g., 1, 10, 25" class="form-input">
                        </div>
                        <div class="md:col-span-2">
                            <label for="high_low_balance" class="form-label">High/Low Balance (e.g., 2 3 for 2 low, 3 high):</label>
                            <input type="text" id="high_low_balance" name="high_low_balance" placeholder="e.g., 2 3 (Low <=34, High >=35)" class="form-input">
                        </div>
                        <div class="md:col-span-2 flex justify-center">
                            <button type="submit" class="btn w-full max-w-xs">Generate Numbers</button>
                        </div>
                    </form>

                    {% if white_balls and powerball %}
                        <h3 class="text-xl font-bold text-indigo-600 mt-6 text-center">Your Generated Numbers:</h3>
                        <div class="number-display">
                            {% for ball in white_balls %}
                                <div class="ball">{{ ball }}</div>
                            {% endfor %}
                            <div class="ball powerball">{{ powerball }}</div>
                        </div>
                        {% if last_draw_dates %}
                            <h4 class="text-lg font-semibold text-gray-700 mt-4 text-center">Last Drawn Dates for Your Numbers:</h4>
                            <ul class="list-disc list-inside text-center">
                                {% for number, date in last_draw_dates.items() %}
                                    <li><span class="font-medium">{{ number }}:</span> {{ date }}</li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                    {% endif %}
                </div>
            </div>

            <!-- Generate Modified Combinations Section -->
            <div class="accordion-item">
                <div class="accordion-header" onclick="toggleAccordion(this)">
                    <span>Generate Modified Combination</span>
                    <span class="accordion-icon">></span>
                </div>
                <div class="accordion-content">
                    <form action="/generate_modified" method="post" class="grid grid-cols-1 gap-4">
                        <div class="flex items-center">
                            <input type="checkbox" id="use_common_pairs" name="use_common_pairs" class="mr-2 rounded-md">
                            <label for="use_common_pairs" class="form-label mb-0">Use Common Pairs for first two numbers</label>
                        </div>
                        <div>
                            <label for="num_range" class="form-label">Filter Common Pairs by Range (e.g., 1 20):</label>
                            <input type="text" id="num_range" name="num_range" placeholder="e.g., 1 20" class="form-input">
                        </div>
                        <div class="flex justify-center">
                            <button type="submit" class="btn w-full max-w-xs">Generate Modified Combination</button>
                        </div>
                    </form>
                    {% if white_balls and powerball %}
                        <h3 class="text-xl font-bold text-indigo-600 mt-6 text-center">Your Modified Numbers:</h3>
                        <div class="number-display">
                            {% for ball in white_balls %}
                                <div class="ball">{{ ball }}</div>
                            {% endfor %}
                            <div class="ball powerball">{{ powerball }}</div>
                        </div>
                        {% if last_draw_dates %}
                            <h4 class="text-lg font-semibold text-gray-700 mt-4 text-center">Last Drawn Dates for Your Numbers:</h4>
                            <ul class="list-disc list-inside text-center">
                                {% for number, date in last_draw_dates.items() %}
                                    <li><span class="font-medium">{{ number }}:</span> {{ date }}</li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                    {% endif %}
                </div>
            </div>

            <!-- Find Results by First White Ball Section -->
            <div class="accordion-item">
                <div class="accordion-header" onclick="toggleAccordion(this)">
                    <span>Find Results by First White Ball Number</span>
                    <span class="accordion-icon">></span>
                </div>
                <div class="accordion-content">
                    <form action="/find_results_by_first_white_ball" method="post" class="grid grid-cols-1 gap-4">
                        <div>
                            <label for="white_ball_number" class="form-label">Enter First White Ball Number (1-69):</label>
                            <input type="number" id="white_ball_number" name="white_ball_number" min="1" max="69" required class="form-input" value="{{ white_ball_number if white_ball_number is defined else '' }}">
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="sort_by_year" name="sort_by_year" class="mr-2 rounded-md" {% if sort_by_year %}checked{% endif %}>
                            <label for="sort_by_year" class="form-label mb-0">Sort by Year</label>
                        </div>
                        <div class="flex justify-center">
                            <button type="submit" class="btn w-full max-w-xs">Find Results</button>
                        </div>
                    </form>
                    {% if results_by_first_white_ball %}
                        <h3 class="text-xl font-bold text-indigo-600 mt-6 text-center">Results for First White Ball: {{ white_ball_number }}</h3>
                        <div class="overflow-x-auto scrollable-table-container">
                            <table class="min-w-full bg-white rounded-lg shadow overflow-hidden">
                                <thead>
                                    <tr>
                                        <th>Draw Date</th>
                                        <th>Number 1</th>
                                        <th>Number 2</th>
                                        <th>Number 3</th>
                                        <th>Number 4</th>
                                        <th>Number 5</th>
                                        <th>Powerball</th>
                                        {% if sort_by_year %}<th>Year</th>{% endif %}
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for result in results_by_first_white_ball %}
                                        <tr>
                                            <td>{{ result['Draw Date'] }}</td>
                                            <td>{{ result['Number 1'] }}</td>
                                            <td>{{ result['Number 2'] }}</td>
                                            <td>{{ result['Number 3'] }}</td>
                                            <td>{{ result['Number 4'] }}</td>
                                            <td>{{ result['Number 5'] }}</td>
                                            <td>{{ result['Powerball'] }}</td>
                                            {% if sort_by_year %}<td>{{ result['Year'] }}</td>{% endif %}
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% elif white_ball_number is defined %}
                        <p class="text-lg text-gray-600 text-center mt-4">No results found for first white ball number {{ white_ball_number }}.</p>
                    {% endif %}
                </div>
            </div>

            <!-- Analysis Tools Section -->
            <div class="accordion-item">
                <div class="accordion-header" onclick="toggleAccordion(this)">
                    <span>Analysis Tools</span>
                    <span class="accordion-icon">></span>
                </div>
                <div class="accordion-content">
                    <h3 class="text-xl font-bold text-indigo-600 mb-4">Frequency Analysis:</h3>
                    <form action="/frequency_analysis" method="get" class="mb-4 text-center">
                        <button type="submit" class="btn">View Frequency Analysis</button>
                    </form>
                    {% if white_ball_freq and powerball_freq %}
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div>
                                <h4 class="text-lg font-semibold text-gray-700 mb-2">White Ball Frequencies (All Time):</h4>
                                <div class="overflow-x-auto scrollable-table-container">
                                    <table class="min-w-full bg-white rounded-lg shadow overflow-hidden">
                                        <thead>
                                            <tr>
                                                <th>Number</th>
                                                <th>Frequency</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for row in white_ball_freq %}
                                                <tr>
                                                    <td>{{ row['Number'] }}</td>
                                                    <td>{{ row['Frequency'] }}</td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div>
                                <h4 class="text-lg font-semibold text-gray-700 mb-2">Powerball Frequencies (All Time):</h4>
                                <div class="overflow-x-auto scrollable-table-container">
                                    <table class="min-w-full bg-white rounded-lg shadow overflow-hidden">
                                        <thead>
                                            <tr>
                                                <th>Number</th>
                                                <th>Frequency</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for row in powerball_freq %}
                                                <tr>
                                                    <td>{{ row['Number'] }}</td>
                                                    <td>{{ row['Frequency'] }}</td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    {% endif %}

                    <h3 class="text-xl font-bold text-indigo-600 mt-8 mb-4">Hot and Cold Numbers:</h3>
                    <form action="/hot_cold_numbers" method="get" class="mb-4 text-center">
                        <button type="submit" class="btn">View Hot and Cold Numbers</button>
                    </form>
                    {% if hot_numbers and cold_numbers %}
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div>
                                <h4 class="text-lg font-semibold text-gray-700 mb-2">Hot Numbers (Last Year):</h4>
                                <div class="overflow-x-auto scrollable-table-container">
                                    <table class="min-w-full bg-white rounded-lg shadow overflow-hidden">
                                        <thead>
                                            <tr>
                                                <th>Number</th>
                                                <th>Frequency</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for row in hot_numbers %}
                                                <tr>
                                                    <td>{{ row['Number'] }}</td>
                                                    <td>{{ row['Frequency'] }}</td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div>
                                <h4 class="text-lg font-semibold text-gray-700 mb-2">Cold Numbers (Last Year):</h4>
                                <div class="overflow-x-auto scrollable-table-container">
                                    <table class="min-w-full bg-white rounded-lg shadow overflow-hidden">
                                        <thead>
                                            <tr>
                                                <th>Number</th>
                                                <th>Frequency</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for row in cold_numbers %}
                                                <tr>
                                                    <td>{{ row['Number'] }}</td>
                                                    <td>{{ row['Frequency'] }}</td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    {% endif %}

                    <h3 class="text-xl font-bold text-indigo-600 mt-8 mb-4">Monthly White Ball Analysis (Last 6 Months):</h3>
                    <form action="/monthly_white_ball_analysis" method="get" class="mb-4 text-center">
                        <button type="submit" class="btn">View Monthly Analysis</button>
                    </form>
                    {% if monthly_balls %}
                        <div class="scrollable-table-container p-2"> {# Added padding for readability #}
                            {% for month, balls in monthly_balls.items() %}
                                <h4 class="text-lg font-semibold text-gray-700 mb-2 mt-4">{{ month }}:</h4>
                                <p class="mb-4 text-sm break-words">{{ balls | join(', ') }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}

                    <h3 class="text-xl font-bold text-indigo-600 mt-8 mb-4">Sum of Main Balls:</h3>
                    <form action="/sum_of_main_balls" method="get" class="mb-4 text-center">
                        <button type="submit" class="btn">View Sum of Main Balls</button>
                    </form>
                    {% if sum_data %}
                        <div class="overflow-x-auto scrollable-table-container">
                            <table class="min-w-full bg-white rounded-lg shadow overflow-hidden">
                                <thead>
                                    <tr>
                                        <th>Draw Date</th>
                                        <th>Sum</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for row in sum_data %}
                                        <tr>
                                            <td>{{ row['Draw Date'] }}</td>
                                            <td>{{ row['Sum'] }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% endif %}

                    <h3 class="text-xl font-bold text-indigo-600 mt-8 mb-4">Find Results by Sum:</h3>
                    <form action="/find_results_by_sum" method="post" class="grid grid-cols-1 gap-4">
                        <div>
                            <label for="target_sum" class="form-label">Target Sum of White Balls:</label>
                            <input type="number" id="target_sum" name="target_sum" min="15" max="345" required class="form-input" value="{{ target_sum if target_sum is defined else '' }}">
                        </div>
                        <div class="flex justify-center">
                            <button type="submit" class="btn w-full max-w-xs">Find Results by Sum</button>
                        </div>
                    </form>
                    {% if results %}
                        <h4 class="text-lg font-semibold text-gray-700 mt-4 text-center">Results with Sum {{ target_sum }}:</h4>
                        <div class="overflow-x-auto scrollable-table-container">
                            <table class="min-w-full bg-white rounded-lg shadow overflow-hidden">
                                <thead>
                                    <tr>
                                        <th>Draw Date</th>
                                        <th>Number 1</th>
                                        <th>Number 2</th>
                                        <th>Number 3</th>
                                        <th>Number 4</th>
                                        <th>Number 5</th>
                                        <th>Sum</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for row in results %}
                                        <tr>
                                            <td>{{ row['Draw Date'] }}</td>
                                            <td>{{ row['Number 1'] }}</td>
                                            <td>{{ row['Number 2'] }}</td>
                                            <td>{{ row['Number 3'] }}</td>
                                            <td>{{ row['Number 4'] }}</td>
                                            <td>{{ row['Number 5'] }}</td>
                                            <td>{{ row['Sum'] }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% elif target_sum is defined %}
                        <p class="text-lg text-gray-600 text-center mt-4">No results found for target sum {{ target_sum }}.</p>
                    {% endif %}

                    <h3 class="text-xl font-bold text-indigo-600 mt-8 mb-4">Simulate Multiple Draws:</h3>
                    <form action="/simulate_multiple_draws" method="post" class="grid grid-cols-1 gap-4">
                        <div>
                            <label for="num_draws" class="form-label">Number of Simulations:</label>
                            <input type="number" id="num_draws" name="num_draws" value="100" min="1" required class="form-input">
                        </div>
                        <div class="flex justify-center">
                            <button type="submit" class="btn w-full max-w-xs">Run Simulation</button>
                        </div>
                    </form>
                    {% if simulated_freq %}
                        <h4 class="text-lg font-semibold text-gray-700 mt-4 text-center">Frequency of Numbers in {{ num_simulations }} Simulated Draws:</h4>
                        <div class="overflow-x-auto scrollable-table-container">
                            <table class="min-w-full bg-white rounded-lg shadow overflow-hidden">
                                <thead>
                                    <tr>
                                        <th>Number</th>
                                        <th>Frequency</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for row in simulated_freq %}
                                        <tr>
                                            <td>{{ row['Number'] }}</td>
                                            <td>{{ row['Frequency'] }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% endif %}

                </div>
            </div>

            <!-- Probability Calculations Section -->
            <div class="accordion-item">
                <div class="accordion-header" onclick="toggleAccordion(this)">
                    <span>Probability Calculations</span>
                    <span class="accordion-icon">></span>
                </div>
                <div class="accordion-content">
                    <h3 class="text-xl font-bold text-indigo-600 mb-4">Winning Probability:</h3>
                    <form action="/winning_probability" method="get" class="mb-4 text-center">
                        <button type="submit" class="btn">Calculate Winning Probability</button>
                    </form>
                    {% if probability_1_in_x and probability_percentage %}
                        <p class="text-lg mb-2"><span class="font-semibold">Overall Winning Probability:</span> {{ probability_1_in_x }}</p>
                        <p class="text-lg mb-2"><span class="font-semibold">As Percentage:</span> {{ probability_percentage }}</p>
                    {% endif %}

                    <h3 class="text-xl font-bold text-indigo-600 mt-8 mb-4">Partial Match Probabilities:</h3>
                    <form action="/partial_match_probabilities" method="get" class="mb-4 text-center">
                        <button type="submit" class="btn">Calculate Partial Match Probabilities</button>
                    </form>
                    {% if probabilities %}
                        <div class="overflow-x-auto scrollable-table-container">
                            <table class="min-w-full bg-white rounded-lg shadow overflow-hidden">
                                <thead>
                                    <tr>
                                        <th>Match Scenario</th>
                                        <th>Odds</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for scenario, odds in probabilities.items() %}
                                        <tr>
                                            <td>{{ scenario }}</td>
                                            <td>{{ odds }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Export Analysis Results -->
            <div class="accordion-item">
                <div class="accordion-header" onclick="toggleAccordion(this)">
                    <span>Export Analysis Results</span>
                    <span class="accordion-icon">></span>
                </div>
                <div class="accordion-content">
                    <p class="text-lg mb-4 text-gray-700">Click the button below to export current analysis results to a CSV file (analysis_results.csv).</p>
                    <form action="/export_analysis_results" method="get" class="text-center">
                        <button type="submit" class="btn w-full max-w-xs">Export to CSV</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        function toggleAccordion(header) {
            header.classList.toggle('active');
            const content = header.nextElementSibling;
            if (content.classList.contains('active')) {
                content.classList.remove('active');
            } else {
                content.classList.add('active');
            }
        }

        // Keep a section open if it contains results from a form submission
        document.addEventListener('DOMContentLoaded', () => {
            const currentPath = window.location.pathname;
            // Check if any of the specific result variables are present in the HTML
            // This is a more robust way to check if a section should be open after a POST request
            // since currentPath won't change for POSTs to the same route.
            const urlParams = new URLSearchParams(window.location.search);
            const isPostRequest = {% if request.method == 'POST' %}true{% else %}false{% endif %};

            if (document.querySelector('.accordion-item:nth-child(1) .number-display') && (currentPath === '/generate' || isPostRequest)) {
                document.querySelector('.accordion-item:nth-child(1) .accordion-header').click();
            } else if (document.querySelector('.accordion-item:nth-child(2) .number-display') && (currentPath === '/generate_modified' || isPostRequest)) {
                document.querySelector('.accordion-item:nth-child(2) .accordion-header').click();
            } else if (document.querySelector('.accordion-item:nth-child(3) table') && (currentPath === '/find_results_by_first_white_ball' || isPostRequest)) {
                document.querySelector('.accordion-item:nth-child(3) .accordion-header').click();
            } else if ((document.querySelector('.accordion-item:nth-child(4) .scrollable-table-container') || document.querySelector('.accordion-item:nth-child(4) .scrollable-table-container')) && 
                       (currentPath === '/frequency_analysis' || currentPath === '/hot_cold_numbers' || 
                        currentPath === '/monthly_white_ball_analysis' || currentPath === '/sum_of_main_balls' || 
                        currentPath === '/find_results_by_sum' || currentPath === '/simulate_multiple_draws' || isPostRequest)) {
                document.querySelector('.accordion-item:nth-child(4) .accordion-header').click();
            } else if (document.querySelector('.accordion-item:nth-child(5) p') && (currentPath === '/winning_probability' || currentPath === '/partial_match_probabilities' || isPostRequest)) {
                document.querySelector('.accordion-item:nth-child(5) .accordion-header').click();
            }
        });
    </script>
</body>
</html>
